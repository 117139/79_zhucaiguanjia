<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>筑采管家</title>
		<meta name="keywords" content="筑采管家">
		<meta name="Description" content="筑采管家">
		<meta name="renderer" content="webkit">
		<meta name=renderer content=webkit>
		<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
		<link rel="stylesheet" type="text/css" href="./css/public.css"/>
		<link rel="stylesheet" type="text/css" href="./js/swiper/css/swiper.min.css"/>
		<script src="./js/jquery.min.js"></script>
		<script src="js/include.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/layer/layer.js"></script>
		<script src="./js/swiper/js/swiper4.min.js"></script>
		<script src="js/vue.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/IPurl.js" type="text/javascript" charset="utf-8"></script>
		<link href="js/pagination/pagination.css" rel="stylesheet" type="text/css" />
		<script src="js/pagination/jquery.pagination.js"></script>
		<style type="text/css">
			/* *,ul,li,p,a{padding: 0;margin: 0;list-style: none;outline: none;color: #000000;} */
			*,ul,li,p,a{padding: 0;margin: 0;list-style: none;outline: none;}
			.cp_ct{
				cursor: pointer;
			}
			#jstCot_ct{
				background-color: #f7f7f7;
				overflow: hidden;
				padding-bottom: 32px;
			}
			.gwcbz_ct{
				margin: 14px auto;
				height: 92px;
				margin-bottom: 6px;
			}
			.bzl_ct{
				width: 115px;
				height: 100%;
				background-color: #f2f2f2; 
				text-align: center;
				line-height: 92px;
				font-size: 12px;
				font-weight: bold;
			}
			.bzr_ct{
				width: calc(100% - 115px);
				height: 100%;
				background-color: #fff;
			}
			.mbxbf_ct{
				width: 376px;
				height: 48px;
				flex-direction: column;
				margin-left: 70px;
			}
			.mbxtxt_ct{
				width: 376px;
				font-size: 12px;
				margin-top: 13px;
			}
			.mbxbf_ct img{
				max-width: 342px;
				max-height: 23px;
			}
			.jstcont_ct{
				background: #FFFFFF;
				padding-bottom: 130px;
			}
			.jstH_ct{
				height: 120px;
			}
			.jsthtimg_ct{
				width: 54px;
				height: 46px;
				margin: 0 18px 0 30px;
			}
			.jsthtimg_ct img{
				max-width: 54px;
				max-height: 46px;
			}
			.jstht_ct{
				flex-direction: column;
			}
			.jstht_ct>span:first-of-type{
				font-size: 26px;
				font-weight: 400;
				color: #333333;
			}
			.jstht_ct>span:last-of-type{
				font-size: 12px;
				font-weight: 400;
				color: #333333;
			}
			.jstjyh_ct{
				padding: 0 31px 0 39px;
			}
			.jstjyh_ct>span{
				font-size: 12px;
				font-weight: 400;
				color: #333333;
			}
			.jstjyh_ct>div>span:first-of-type{
				font-size: 12px;
				font-weight: 400;
				color: #333333;
			}
			.jstjyh_ct>div>span:last-of-type{
				font-size: 20px;
				font-weight: 400;
				color: #FF7B7B;
			}
			.zffs_ct{
				margin-top: 16px;
				padding: 0 31px 0 39px;
			}
			.zffs_ct>h6{
				font-size: 16px;
				color: #333333;
			}
			.zffscon_ct{
				margin-top: 10px;
				border: 1px dashed #E5E5E5;
			}
			.zffscon_ct>ul{
				width: 370px;
				background: #F2F2F2;
				flex-shrink: 0;
			}
			.zffscon_ct>ul>li{
				height: 62px;
			}
			.activeli{
				background-color: #fff;
			}
			.zffscon_ct>ul>li img{
				max-width: 36px;
				max-height: 33px;
				margin: 0 12px;
			}
			.zffscon_ct>ul>li span{
				font-size: 16px;
				font-weight: 400;
				color: #333333;
			}
			.zfxsnr_ct{
				padding: 28px 0 20px 0;
			}
			.zfnrl_ct{
				flex-direction: column;
				margin: 0 52px 0 220px;
			}
			.zfnrl_ct>div{
				width: 173px;
				height: 173px;
				border: 1px solid #4AAF1A;
				margin-bottom: 27px;
			}
			.zfnrl_ct>div img{
				max-width: 150px;
				max-height: 150px;
			}
			.zfnrl_ct span{
				font-size: 16px;
				font-weight: 400;
				color: #333333;
			}
			.zfnrr_ct{
				width: 276px;
				min-height: 167px;
				border-left: 1px #999999 dashed;
				flex-direction: column;
			}
			.zfnrr_ct>span{
				font-size: 16px;
				font-weight: 400;
				color: #333333;
			}
			.zfnrr_ct>div{
				font-size: 16px;
				font-weight: 400;
				color: #333333;
				margin-top: 10px;
			}
			.zfnrr_ct>div span{
				font-size: 36px;
				font-weight: 400;
				color: #FF5E5E;
			}
			.zfxsnr2_ct{
				padding: 28px 0 17px 0;
			}
			.uhkzfl_ct{
				margin-left: 23px;
				flex-shrink: 0;
			}
			.uhkzfl_ct>span{
				font-size: 14px;
				font-weight: 400;
				color: #333333;
			}
			.uhkzfl_ct table{
				margin: 15px 0 0 3px;
			}
			.uhkzfl_ct tr{
				height: 42px;
				font-size: 12px;
				font-weight: 400;
				color: #333333;
				text-align: left;
			}
			.uhkzfl_ct tr>td:first-of-type{
				width: 89px;
				padding: 0 10px;
			}
			.uhkzfl_ct tr>td:last-of-type{
				width: 250px;
				padding: 0 20px;
			}
			.uhkzfr_ct{
				border-left: 1px dashed #999999;
				margin-left: 28px;
				flex-direction: column;
				padding-left: 22px;
			}
			.uhkzfr_ct>span:first-of-type{
				font-size: 14px;
				font-weight: 400;
				color: #333333;
			}
			.uhkzfr_ct>span:last-of-type{
				font-size: 12px;
				font-weight: 400;
				color: #333333;
			}
			.uhkzfr_ct>div{
				margin-top: 20px;
				flex-wrap: wrap;
			}
			.uhkzfr_ct>div>div{
				width: 98px;
				height: 98px;
				margin: 0 20px 20px 0;
			}
			.uhkzfr_ct>div>div>img{
				max-width: 98px;
				max-height: 98px;
			}
			.uhkzfr_ct>button{
				width: 142px;
				height: 43px;
				background: #EB5F34;
				border-radius: 4px;
				font-size: 14px;
				font-weight: 400;
				color: #FFFFFF;
				border: none;
				margin-top: 87px;
			}
		</style> 
		
	</head>
	<body>
		<div class="w100" style="height: 187px;">
			<div class="header_top">
				<include src="./common/header.html"></include>
				<!-- <include src="http://www.wanbonet.com/suxin/79_zhucaiguanjia/common/header.html"></include> -->
			</div>
			<include src="./common/header1.html"></include>
			<!-- <include src="http://www.wanbonet.com/suxin/79_zhucaiguanjia/common/header1.html"></include> -->
		
		
			<!-- header -->
		
			<include src="./common/header_header.html"></include>
		</div>
		
		<!-- 中间内容部分 -->
		<div id="jstCot_ct">
			
			<div class="w1200 gwcbz_ct flex aic">
				<div class="bzl_ct">订单确认页</div>
				<div class="bzr_ct flex aic">
					 <div class="mbxbf_ct flex aic">
						 <img src="img/jstnvaimg.png" >
						 <div class="mbxtxt_ct flex ju_b">
							 <div>加入采购单</div>
							 <span>填写核对订单信息</span>
							 <div>支付订单</div>
						 </div>
					 </div>
				</div>
			</div>
			<div class="jstcont_ct w1200">
				<div class="jstH_ct flex aic">
					<div class="jsthtimg_ct flex aic ju_c">
						<img src="img/jstlogo.png" alt="">
					</div>
					<div class="jstht_ct flex">
						<span>结算台</span>
						<span>您正在使用筑采结算台</span>
					</div>
				</div>
				<div class="jstjyh_ct flex ju_b aife">
					<span>交易号 : {{tempobj.order_code}}</span>
					<div>
						<span>应付金额 : </span>
						<span>￥{{tempobj.pay_money}}</span>
					</div>
				</div>
				<div class="zffs_ct">
					<h6>支付方式</h6>
					<div class="zffscon_ct flex">
						<ul>
							<li class="cp_ct flex aic"
							@click="zffs='wx'"
							:class="{activeli: zffs=='wx'}">
								<img src="img/jstwxtb1.png" v-show="zffs=='wx'">
								<img src="img/jstwxtb.png" v-show="zffs!=='wx'">
								<span>微信扫码</span>
							</li>
							<li class="cp_ct flex aic"
							@click="zffs='yhk'"
							:class="{activeli:zffs=='yhk'}">
								<img src="img/jstyhktb1.png" v-show="zffs=='yhk'">
								<img src="img/jstyhktb.png" v-show="zffs!=='yhk'">
								<span>银行转账</span>
							</li>
						</ul>
						<div class="zfxsnr_ct flex aic" v-show="zffs=='wx'">
							<div class="zfnrl_ct flex aic">
								<div class="flex aic ju_c">
									<img :src="wxewm.data" >
								</div>
								<span>请打开微信扫描上方二维码</span>
							</div>
							<div class="zfnrr_ct flex aic ju_c">
								<span>应付金额</span>
								<div>
									<span>{{tempobj.pay_money}}</span>元
								</div>
							</div>
						</div>
						<div class="zfxsnr2_ct flex aic" v-show="zffs=='yhk'">
							<div class="uhkzfl_ct">
								<span>转账银行信息：</span>
								<table border="1" cellspacing="" cellpadding="">
									<tr>
										<td>户名</td>
										<td>{{bank.bank_member_name}}</td>
									</tr>
									<tr>
										<td>账户</td>
										<td>{{bank.bank_member}}</td>
									</tr>
									<tr>
										<td>开户行</td>
										<td>{{bank.bank_name}}</td>
									</tr>
									<tr>
										<td>联行号</td>
										<td>{{bank.bank_code}}</td>
									</tr>
									<tr>
										<td>订单编号：</td>
										<td>{{tempobj.order_code}}</td>
									</tr>
									<tr>
										<td>联系方式</td>
										<td>{{bank.bank_member_mobile}}</td>
									</tr>
								</table>
							</div>
							<div class="uhkzfr_ct flex ">
								<span>上传凭证：</span>
								<div style="width: 325px;">
									<div style="display: flex;width: 100%;">
										<div class="up_img bg_div" v-for="(item,index) in yjfk_img">
											<img @click="up_img_del(index)" class="img_del" src="./img/img_del.png" alt="">
											<div :style="'background-image: url('+getimg(item)+');'"></div>
										</div>
										<div class="up_img" v-if="yjfk_img.length<1">
											<img src="./img/upimg_03.jpg" alt="">
											<!-- <input id="scheaderimg" type="file" @change="getint_img"> -->
											<!-- <input id="scheaderimg" type="file" @change="uploadImg($event)"> -->
											<form id="form">
												<input id="scheaderimg" type="file" name="file" @change="uploadImg($event)">
											</form>
										</div>
									</div>
								</div>
								<span>注：上传银行转账还记录凭证</span>
								<button class="cp_ct" @click="sub">提交</button>
							</div>
						</div>
					</div>
				</div>
			</div>
			
		
			
		</div>
		
		
		<include src="./common/footer.html"></include>
		<script type="text/javascript">
			var that;
			var app = new Vue({
				el: '#jstCot_ct',
				data: {
					// 支付方式
					zffs: 'wx',
					// 获取参数
					tempobj: {},
					// 微信二维码
					wxewm: {},
					// 定时器
					timer1: null,
					yjfk_img:[],
					bank: {}
				},
				created() {
					that = this
					
					if(storage_fuc.getItem("user")){
						login_m(function(res){
							console.log(res)
							that.user_datas=res.data
							that.token=res.token
						})
						
					}else{
						window.location.replace('login.html')
						return
					}
					
					
					that.bank = JSON.parse(localStorage.getItem('BaseConfig')).bank_info
					console.log(that.bank)
					
					
					
					
					this.tempobj = getNowCanshu()
					if(getNowCanshu().type){
						this.zffs = getNowCanshu().type
					}
					that.getwxcode()
					// this.timer1 = setInterval(function(){
					// 	that.getwxcode()
					// },1000)
				},
				computed:{
				},
				methods: {
					getimg:function(img){
						// if(!img){
						// 	return
						// }
						return getimg(img)
					},
					uploadImg:function(file){
						var  _this=this
						$.ajax({
							type: "POST",
							url: IPurl+'/Base/upload',
							headers:{
								"Authorization":storage_fuc.getItem("token")||'',
							},
							// beforeSend: function(request) {      //使用beforeSend
							// 	request.setRequestHeader("Authorization", storage_fuc.getItem("token"));
							// },
							
							data: new FormData($('#form')[0]),
							// async:false,
							cache: false,
							processData: false,
							contentType: false,//不去设置Content-Type请求头
							// enctype: 'multipart/form-data',    //需要正确设置此项
							
							success: function(res) {
								// console.log(res);
								if(typeof(res)=='string'){
									res=JSON.parse(res)
								}
								if(res.status == 101){
									parent.location.href="login.html?type=1"
									return
								}
								if (res.status == 200) {
								console.log(res)
									layer.msg('上传成功')
									 _this.yjfk_img.push(res.data)
								} else {
									if(res.msg){
										layer.msg(res.msg)
									}else{
										layer.msg('操作失败')
									}
								}
						
							},
							error: function(err) {
								layer.msg('获取数据失败')
								console.log(err)
							}
						})
						
					},
					up_img_del:function(index){
						var _this=this
						layer.confirm('是否删除该图片？', {
						  btn: ['确定','取消'] //按钮
						}, function(){
						  layer.msg('操作成功');
							_this.yjfk_img.splice(index, 1)
						}, function(){
						  
						});
						
					},
					sub:function(){
						var that=this
						var imgs=that.yjfk_img
						if(imgs.length == 0){
							layer.msg('请上传图片')
							return
						}
						var datas = {
							order_code: that.tempobj.order_code, //订单号
							bank_pic:imgs,//银行转账凭证 单图
						}
						_post('Order.GoodsOrder/bankPay',datas,function(res){
							if(res.status == 200){
								layer.msg(res.msg)
								setTimeout(function(){
									window.location = 'grzx.html?my_cur=0'
								},500)
							}
						})
					},
					getwxcode:function(){
						$.ajax({
							type: 'POST',
							url: IPurl+'Order.GoodsOrder/wechatNativeQrcode',
							data: {order_code:this.tempobj.order_code},
							headers:{
								"Authorization":storage_fuc.getItem("token")||'',
							},
							success: function(res){
								if(res.status == 101){
									parent.location.href="login.html?type=1"
									return
								}
								if(res.status != 200){
									if(res.msg){
										layer.msg(res.msg)
										if(res.msg = "订单已支付"){
											clearInterval(that.timer1)
											setTimeout(function(){
												window.location = 'grzx.html?my_cur=0'
											},500)
										}
									}else{
										layer.msg('操作失败')
									}
								}else{
									that.$set(that.wxewm,"data", res.data)
								}
							}
						})
					},
				}
			})
		</script>
	</body>
</html>
